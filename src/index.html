<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocalRouter AI</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f5f5f7;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 2rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
      }

      .header p {
        font-size: 0.875rem;
        opacity: 0.9;
      }

      .main-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .tabs {
        background: white;
        width: 200px;
        border-right: 1px solid #e5e7eb;
        padding: 1rem 0;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
      }

      .tab {
        padding: 0.75rem 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
        border-left: 3px solid transparent;
        color: #6b7280;
        font-weight: 500;
      }

      .tab:hover {
        background: #f9fafb;
        color: #374151;
      }

      .tab.active {
        background: #f0f9ff;
        color: #2563eb;
        border-left-color: #2563eb;
      }

      .content {
        flex: 1;
        padding: 2rem;
        overflow-y: auto;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .card h2 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
        color: #1f2937;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .stat-card h3 {
        font-size: 0.875rem;
        opacity: 0.9;
        margin-bottom: 0.5rem;
      }

      .stat-card .value {
        font-size: 2rem;
        font-weight: bold;
      }

      .chart-placeholder {
        background: #f9fafb;
        border: 2px dashed #e5e7eb;
        border-radius: 8px;
        height: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
        font-weight: 500;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 0.625rem 1.25rem;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #6b7280;
      }

      .api-key-list, .router-list, .provider-list {
        list-style: none;
      }

      .api-key-item, .router-item, .provider-item {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .api-key-info h3, .router-info h3, .provider-info h3 {
        font-size: 1rem;
        color: #1f2937;
        margin-bottom: 0.25rem;
      }

      .api-key-info p, .router-info p, .provider-info p {
        font-size: 0.875rem;
        color: #6b7280;
      }

      .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .badge.success {
        background: #d1fae5;
        color: #065f46;
      }

      .badge.error {
        background: #fee2e2;
        color: #991b1b;
      }

      .badge.warning {
        background: #fef3c7;
        color: #92400e;
      }

      .loading {
        text-align: center;
        padding: 2rem;
        color: #6b7280;
      }

      .empty-state {
        text-align: center;
        padding: 3rem;
        color: #6b7280;
      }

      .empty-state svg {
        width: 64px;
        height: 64px;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
      }

      .form-group input, .form-group select {
        width: 100%;
        padding: 0.625rem;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 0.875rem;
      }

      .form-group input:focus, .form-group select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .modal-header h2 {
        font-size: 1.5rem;
        color: #1f2937;
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: #6b7280;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
      }

      .close-btn:hover {
        background: #f3f4f6;
      }

      .button-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 1.5rem;
      }

      .code-display {
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 1rem;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 0.875rem;
        word-break: break-all;
        margin: 1rem 0;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>LocalRouter AI</h1>
      <p>Intelligent AI Model Routing</p>
    </div>

    <div class="main-container">
      <nav class="tabs">
        <div class="tab active" onclick="switchTab('home')">Home</div>
        <div class="tab" onclick="switchTab('api-keys')">API Keys</div>
        <!-- <div class="tab" onclick="switchTab('routers')">Routers</div> -->
        <div class="tab" onclick="switchTab('providers')">Providers</div>
      </nav>

      <main class="content">
        <!-- Home Tab -->
        <div id="home-tab" class="tab-content active">
          <div class="stats-grid">
            <div class="stat-card">
              <h3>Total Requests</h3>
              <div class="value" id="stat-requests">0</div>
            </div>
            <div class="stat-card">
              <h3>Total Tokens</h3>
              <div class="value" id="stat-tokens">0</div>
            </div>
            <div class="stat-card">
              <h3>Total Cost</h3>
              <div class="value" id="stat-cost">$0.00</div>
            </div>
            <div class="stat-card">
              <h3>Active Keys</h3>
              <div class="value" id="stat-keys">0</div>
            </div>
          </div>

          <div class="card">
            <h2>Request Volume</h2>
            <div class="chart-placeholder">
              Chart coming soon - Requests over time
            </div>
          </div>

          <div class="card">
            <h2>Cost Analysis</h2>
            <div class="chart-placeholder">
              Chart coming soon - Cost breakdown by provider
            </div>
          </div>
        </div>

        <!-- API Keys Tab -->
        <div id="api-keys-tab" class="tab-content">
          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h2 style="margin: 0;">API Keys</h2>
              <button class="btn" onclick="showCreateKeyModal()">+ Create New Key</button>
            </div>
            <div id="api-keys-loading" class="loading">Loading API keys...</div>
            <ul id="api-keys-list" class="api-key-list" style="display: none;"></ul>
            <div id="api-keys-empty" class="empty-state" style="display: none;">
              <p>No API keys found. Create your first key to get started.</p>
            </div>
          </div>
        </div>

        <!-- Routers Tab -->
        <div id="routers-tab" class="tab-content">
          <div class="card">
            <h2>Router Configurations</h2>
            <div id="routers-loading" class="loading">Loading routers...</div>
            <ul id="routers-list" class="router-list" style="display: none;"></ul>
            <div id="routers-empty" class="empty-state" style="display: none;">
              <p>No routers configured.</p>
            </div>
          </div>
        </div>

        <!-- Providers Tab -->
        <div id="providers-tab" class="tab-content">
          <div class="card">
            <h2>Provider Status</h2>
            <p style="color: #6b7280; margin-bottom: 1rem; font-size: 0.875rem;">
              Configure API keys for external providers. Keys are stored securely in your system keyring.
            </p>
            <div id="providers-loading" class="loading">Loading providers...</div>
            <ul id="providers-list" class="provider-list" style="display: none;"></ul>
          </div>

          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h2 style="margin: 0;">Server Configuration</h2>
              <button class="btn" onclick="reloadConfiguration()" style="padding: 0.375rem 0.75rem; font-size: 0.75rem;">
                Reload Config
              </button>
            </div>
            <p style="color: #6b7280; margin-bottom: 1rem; font-size: 0.875rem;">
              Configuration file: <code style="background: #f3f4f6; padding: 0.125rem 0.375rem; border-radius: 3px;">~/Library/Application Support/LocalRouter/settings.yaml</code>
            </p>
            <div id="server-config-loading" class="loading">Loading...</div>
            <div id="server-config-content" style="display: none;">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                <div>
                  <label style="font-size: 0.875rem; font-weight: 500; color: #6b7280;">Host</label>
                  <p style="font-size: 1rem; color: #1f2937; margin-top: 0.25rem;" id="server-host">-</p>
                </div>
                <div>
                  <label style="font-size: 0.875rem; font-weight: 500; color: #6b7280;">Port</label>
                  <p style="font-size: 1rem; color: #1f2937; margin-top: 0.25rem;" id="server-port">-</p>
                </div>
                <div>
                  <label style="font-size: 0.875rem; font-weight: 500; color: #6b7280;">CORS</label>
                  <p style="font-size: 1rem; color: #1f2937; margin-top: 0.25rem;" id="server-cors">-</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Create API Key Modal -->
    <div id="create-key-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create API Key</h2>
          <button class="close-btn" onclick="hideCreateKeyModal()">&times;</button>
        </div>
        <form id="create-key-form" onsubmit="createApiKey(event)">
          <div class="form-group">
            <label for="key-name">Key Name (optional)</label>
            <input type="text" id="key-name" placeholder="My Application Key" />
          </div>
          <div class="form-group">
            <label for="model-selection">Model Selection</label>
            <select id="model-selection" required>
              <option value="">Select routing strategy...</option>
              <option value="router_mincost">Router: Minimum Cost</option>
              <option value="router_maxperf">Router: Maximum Performance</option>
              <option value="router_balanced">Router: Balanced</option>
              <option value="specific">Specific Provider/Model</option>
            </select>
          </div>
          <div class="form-group" id="specific-model-group" style="display: none;">
            <label for="specific-model">Provider/Model</label>
            <input type="text" id="specific-model" placeholder="e.g., ollama/llama3.3 or openai/gpt-4" />
          </div>
          <div class="button-group">
            <button type="submit" class="btn">Create Key</button>
            <button type="button" class="btn btn-secondary" onclick="hideCreateKeyModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- New Key Display Modal -->
    <div id="new-key-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Key Created</h2>
          <button class="close-btn" onclick="hideNewKeyModal()">&times;</button>
        </div>
        <p style="color: #6b7280; margin-bottom: 1rem;">
          Save this key securely. You won't be able to see it again.
        </p>
        <div class="code-display" id="new-key-display"></div>
        <div class="button-group">
          <button class="btn" onclick="copyNewKey()">Copy to Clipboard</button>
          <button class="btn btn-secondary" onclick="hideNewKeyModal()">Close</button>
        </div>
      </div>
    </div>

    <!-- Configure Provider Modal -->
    <div id="provider-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="provider-modal-title">Configure Provider</h2>
          <button class="close-btn" onclick="hideProviderModal()">&times;</button>
        </div>
        <form id="provider-form" onsubmit="saveProviderKey(event)">
          <div class="form-group">
            <label for="provider-api-key">API Key</label>
            <input type="password" id="provider-api-key" required placeholder="Enter API key..." />
            <p style="color: #6b7280; font-size: 0.75rem; margin-top: 0.5rem;">
              Key will be stored securely in your system keyring (Keychain on macOS).
            </p>
          </div>
          <div class="button-group">
            <button type="submit" class="btn">Save Key</button>
            <button type="button" class="btn btn-secondary" onclick="deleteProviderKey()" id="delete-key-btn" style="display: none;">Delete Key</button>
            <button type="button" class="btn btn-secondary" onclick="hideProviderModal()">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Try different Tauri API access methods for v2.x
      let invoke;
      try {
        if (window.__TAURI__?.core?.invoke) {
          invoke = window.__TAURI__.core.invoke;
        } else if (window.__TAURI__?.invoke) {
          invoke = window.__TAURI__.invoke;
        } else if (window.__TAURI_INTERNALS__?.invoke) {
          invoke = window.__TAURI_INTERNALS__.invoke;
        } else {
          console.error('Could not find Tauri invoke function', window.__TAURI__);
        }
      } catch (e) {
        console.error('Error accessing Tauri API:', e);
      }

      let currentTab = 'home';
      let newKeyValue = '';
      let currentProvider = null;

      // Initialize on load
      document.addEventListener('DOMContentLoaded', async () => {
        console.log('LocalRouter AI loaded');
        console.log('Tauri API available:', !!invoke);
        console.log('window.__TAURI__:', window.__TAURI__);

        if (invoke) {
          loadApiKeys();
          loadRouters();
          loadProviders();
          loadServerConfig();

          // Subscribe to configuration changes
          try {
            const { listen } = window.__TAURI__.event || window.__TAURI__;
            if (listen) {
              await listen('config-changed', (event) => {
                console.log('Configuration changed:', event.payload);
                // Reload all configuration-dependent UI elements
                loadRouters();
                loadProviders();
                loadServerConfig();
              });
              console.log('Subscribed to config-changed events');
            } else {
              console.warn('Event listener not available');
            }
          } catch (e) {
            console.error('Failed to subscribe to config changes:', e);
          }
        } else {
          console.error('Tauri invoke not available - check Tauri configuration');
        }
      });

      // Tab switching
      function switchTab(tabName) {
        // Update tab buttons
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');

        // Update content
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(`${tabName}-tab`).classList.add('active');

        currentTab = tabName;

        // Reload data when switching to specific tabs
        if (tabName === 'api-keys') {
          loadApiKeys();
        } else if (tabName === 'routers') {
          loadRouters();
        } else if (tabName === 'providers') {
          loadProviders();
          loadServerConfig();
        }
      }

      // API Keys
      async function loadApiKeys() {
        const loading = document.getElementById('api-keys-loading');
        const list = document.getElementById('api-keys-list');
        const empty = document.getElementById('api-keys-empty');

        loading.style.display = 'block';
        list.style.display = 'none';
        empty.style.display = 'none';

        try {
          const keys = await invoke('list_api_keys');
          loading.style.display = 'none';

          if (keys.length === 0) {
            empty.style.display = 'block';
          } else {
            list.style.display = 'block';
            list.innerHTML = keys.map(key => `
              <li class="api-key-item">
                <div class="api-key-info">
                  <h3>${key.name}</h3>
                  <p>
                    ID: ${key.id.substring(0, 8)}... |
                    ${formatModelSelection(key.model_selection)} |
                    Created: ${new Date(key.created_at).toLocaleDateString()}
                  </p>
                </div>
                <span class="badge ${key.enabled ? 'success' : 'error'}">
                  ${key.enabled ? 'Enabled' : 'Disabled'}
                </span>
              </li>
            `).join('');

            // Update home stats
            document.getElementById('stat-keys').textContent = keys.filter(k => k.enabled).length;
          }
        } catch (error) {
          console.error('Failed to load API keys:', error);
          loading.innerHTML = `<p style="color: #ef4444;">Error loading API keys: ${error}</p>`;
        }
      }

      function formatModelSelection(selection) {
        if (typeof selection === 'string') {
          return selection;
        } else if (selection.type === 'router') {
          return `Router: ${selection.router_name}`;
        } else if (selection.type === 'direct_model') {
          return `${selection.provider}/${selection.model}`;
        }
        return 'Unknown';
      }

      async function createApiKey(event) {
        event.preventDefault();

        const name = document.getElementById('key-name').value || null;
        const selectionType = document.getElementById('model-selection').value;

        let modelSelection;
        if (selectionType.startsWith('router_')) {
          // Format: { type: "router", router_name: "mincost" }
          modelSelection = {
            type: "router",
            router_name: selectionType.replace('router_', '')
          };
        } else if (selectionType === 'specific') {
          const specific = document.getElementById('specific-model').value;
          const [provider, model] = specific.split('/');
          if (!provider || !model) {
            alert('Please enter provider and model in format: provider/model');
            return;
          }
          // Format: { type: "direct_model", provider: "ollama", model: "llama3.3" }
          modelSelection = {
            type: "direct_model",
            provider: provider.trim(),
            model: model.trim()
          };
        } else {
          alert('Please select a model selection strategy');
          return;
        }

        try {
          const result = await invoke('create_api_key', { name, modelSelection });
          newKeyValue = result[0]; // The actual key string
          document.getElementById('new-key-display').textContent = newKeyValue;

          hideCreateKeyModal();
          showNewKeyModal();
          loadApiKeys();
        } catch (error) {
          console.error('Failed to create API key:', error);
          alert(`Error creating API key: ${error}`);
        }
      }

      // Routers
      async function loadRouters() {
        const loading = document.getElementById('routers-loading');
        const list = document.getElementById('routers-list');
        const empty = document.getElementById('routers-empty');

        loading.style.display = 'block';
        list.style.display = 'none';
        empty.style.display = 'none';

        try {
          const routers = await invoke('list_routers');
          loading.style.display = 'none';

          if (routers.length === 0) {
            empty.style.display = 'block';
          } else {
            list.style.display = 'block';
            list.innerHTML = routers.map(router => `
              <li class="router-item">
                <div class="router-info">
                  <h3>${router.name}</h3>
                  <p>
                    Strategy: ${router.strategy} |
                    Providers: ${router.providers.join(', ')} |
                    Fallback: ${router.fallback_enabled ? 'Enabled' : 'Disabled'}
                  </p>
                </div>
                <span class="badge success">Active</span>
              </li>
            `).join('');
          }
        } catch (error) {
          console.error('Failed to load routers:', error);
          loading.innerHTML = `<p style="color: #ef4444;">Error loading routers: ${error}</p>`;
        }
      }

      // Providers
      async function loadProviders() {
        const loading = document.getElementById('providers-loading');
        const list = document.getElementById('providers-list');

        loading.style.display = 'block';
        list.style.display = 'none';

        try {
          const providers = await invoke('list_providers_with_key_status');
          loading.style.display = 'none';
          list.style.display = 'block';

          list.innerHTML = providers.map(provider => `
            <li class="provider-item">
              <div class="provider-info">
                <h3>${provider.name}</h3>
                <p>${provider.provider_type} ${provider.enabled ? '' : '(Disabled)'}</p>
              </div>
              <div style="display: flex; gap: 0.5rem; align-items: center;">
                <span class="badge ${provider.has_api_key ? 'success' : 'warning'}">
                  ${provider.has_api_key ? 'Configured' : 'Not Configured'}
                </span>
                <button class="btn" onclick="showProviderModal('${provider.key_ref}', '${provider.name}', ${provider.has_api_key})" style="padding: 0.375rem 0.75rem; font-size: 0.75rem;">
                  ${provider.has_api_key ? 'Update' : 'Configure'}
                </button>
              </div>
            </li>
          `).join('');
        } catch (error) {
          console.error('Failed to load providers:', error);
          loading.innerHTML = `<p style="color: #ef4444;">Error loading providers: ${error}</p>`;
        }
      }

      async function loadServerConfig() {
        const loading = document.getElementById('server-config-loading');
        const content = document.getElementById('server-config-content');

        loading.style.display = 'block';
        content.style.display = 'none';

        try {
          const config = await invoke('get_config');
          loading.style.display = 'none';
          content.style.display = 'block';

          document.getElementById('server-host').textContent = config.server.host;
          document.getElementById('server-port').textContent = config.server.port;
          document.getElementById('server-cors').textContent = config.server.enable_cors ? 'Enabled' : 'Disabled';
        } catch (error) {
          console.error('Failed to load server config:', error);
          loading.innerHTML = `<p style="color: #ef4444;">Error loading config: ${error}</p>`;
        }
      }

      // Modal functions
      function showCreateKeyModal() {
        document.getElementById('create-key-modal').classList.add('active');
      }

      function hideCreateKeyModal() {
        document.getElementById('create-key-modal').classList.remove('active');
        document.getElementById('create-key-form').reset();
        document.getElementById('specific-model-group').style.display = 'none';
      }

      function showNewKeyModal() {
        document.getElementById('new-key-modal').classList.add('active');
      }

      function hideNewKeyModal() {
        document.getElementById('new-key-modal').classList.remove('active');
        newKeyValue = '';
      }

      function copyNewKey() {
        navigator.clipboard.writeText(newKeyValue).then(() => {
          alert('API key copied to clipboard!');
        }).catch(err => {
          console.error('Failed to copy:', err);
        });
      }

      function showProviderModal(keyRef, name, hasKey) {
        currentProvider = { keyRef, name, hasKey };
        document.getElementById('provider-modal-title').textContent = `Configure ${name}`;
        document.getElementById('provider-api-key').value = '';
        document.getElementById('delete-key-btn').style.display = hasKey ? 'block' : 'none';
        document.getElementById('provider-modal').classList.add('active');
      }

      function hideProviderModal() {
        document.getElementById('provider-modal').classList.remove('active');
        document.getElementById('provider-form').reset();
        currentProvider = null;
      }

      async function saveProviderKey(event) {
        event.preventDefault();
        if (!currentProvider) return;

        const apiKey = document.getElementById('provider-api-key').value;

        try {
          await invoke('set_provider_api_key', {
            provider: currentProvider.keyRef,
            apiKey: apiKey
          });
          alert(`API key saved for ${currentProvider.name}`);
          hideProviderModal();
          loadProviders();
        } catch (error) {
          console.error('Failed to save provider key:', error);
          alert(`Error saving API key: ${error}`);
        }
      }

      async function reloadConfiguration() {
        try {
          await invoke('reload_config');
          console.log('Configuration reloaded');
        } catch (error) {
          console.error('Failed to reload configuration:', error);
          alert(`Error reloading configuration: ${error}`);
        }
      }

      async function deleteProviderKey() {
        if (!currentProvider) return;

        if (!confirm(`Delete API key for ${currentProvider.name}?`)) {
          return;
        }

        try {
          await invoke('delete_provider_api_key', {
            provider: currentProvider.keyRef
          });
          alert(`API key deleted for ${currentProvider.name}`);
          hideProviderModal();
          loadProviders();
        } catch (error) {
          console.error('Failed to delete provider key:', error);
          alert(`Error deleting API key: ${error}`);
        }
      }

      // Show/hide specific model input based on selection
      document.addEventListener('DOMContentLoaded', () => {
        const modelSelect = document.getElementById('model-selection');
        const specificGroup = document.getElementById('specific-model-group');

        if (modelSelect) {
          modelSelect.addEventListener('change', (e) => {
            if (e.target.value === 'specific') {
              specificGroup.style.display = 'block';
            } else {
              specificGroup.style.display = 'none';
            }
          });
        }
      });
    </script>
  </body>
</html>
